# 简介 Introduction

`Apache Kafka®` 是一个分布式流平台。这到底是什么意思呢？

 流平台具有三个关键功能：

* 发布和订阅记录消息记录流，类似于消息队列或企业消息传递系统
* 以持久的且具有容错能力的方式存储消息记录流
* 处理消息记录流

`Kafka`通常用于两大类应用程序：

* 建立实时的流数据管道，使系统或应用程序之间能够可靠地获取数据
* 建立实时的流应用程序，可以转换或响应数据流

为了理解`Kafka`如何完成这些事，让我们从头开始深入探索`Kafka`的功能。

首先了解几个概念：

* `Kafka`是在一个或多个可以跨越多个数据中心的服务器上以集群方式运行
* `Kafka`集群以`topics`归类储存的消息记录流
* 每条数据记录由一个键、一个值和一个时间戳构成

`Kafka`有四大核心`APIs`：

![1-1 核心APIs示意图](../.gitbook/assets/kafka-apis.png)


* [`Producer API`][producer]（生产者）允许应用程序发布数据记录流到一个或多个`topics`中
* [`Consumer API`][consumer]（消费者）允许应用程序订阅一个或多个`topics`并处理其生成的数据记录流
* [`Streams API`][streams]（流处理）允许应用程序作为流处理器，消费从一个或多个`topics`中获取的输入流并生产输出流到一个或多个`toppics`中，有效地进行输入流和输出流的转换
* [`Connector API`][connector]（连接器）允许建立和允许可复用的生产者和消费者，用来连接`topics`和已存在的应用程序或数据系统。例如关系型数据库的连接器可能会捕捉对表的所有更改

在`Kafka`中，服务端和客户端之间的通信是通过简单、高性能、无关编程语言的`TCP`协议来完成。该协议已经版本化，并维持对旧版本的向下兼容。我们提供`Java`版本的`Kafka`客户端，但客户端也同时支持[多种语言][multi-languages]。

## 主题和日志 Topics and Logs <a id="topics-n-logs"></a>

首先深入了解一个`Kafka`提供的数据记录流的核心抽象——**主题**(**`topic`**)

**主题**是数据记录发布的分类名称或订阅源名称。Kafka中的**主题**总是面向多订阅者的；也就是说一个主题可以拥有`0`个、`1`个或许多消费者来订阅写入该主题的数据。

对于每个主题，`Kafka`集群都会维护一个分区日志，其结构如下图所示：

![1-2 主题分区日志解析图](../.gitbook/assets/log_anatomy.png)

每个分区(**`partition`**)都是有序、不可变更的数据记录序列，数据记录可以持续地追加到结构化的提交日志中。分区中的数据记录都会被分配一个顺序生成的ID号，被称为偏移量(**`offset`**)，是每条数据记录在分区中的唯一识别标记。

`Kafka`集群会持久地保存所有发布的数据记录，不论其是否被消费使用，其保留期限是可以被配置的。例如如果保留策略设置为两天，那么一条数据记录发布后的两天之内是可以被消费的，之后会被丢弃以释放空间。`Kafka`的性能在不同数据大小情况下几乎是恒定的，因此长时间储存数据是没有问题的。

![1-3 分区日志示意图](../.gitbook/assets/log_consumer.png)

事实上，每个消费者底层保留的唯一元数据是其在日志中的偏移量或位置。此偏移量是可以被消费者控制的：通常来说，消费者读取数据记录时会线性的向前移动其偏移量；但事实上，由于位置可以被消费者控制，那么就可以以想要的任意顺序消费这些消息记录。例如消费者可以重置到较早的偏移量以重新处理过往的数据，也可以跳到最新的消息记录位置并从“现在”开始消费记录。

这些功能的组合意味着`Kafka`消费者是非常轻便的，他们来去自如并且不会对集群或其他消费者产生太多影响。若你使用我们的命令行工具来监控任何topic的尾部内容，你并不会看到其他消费者消费数据时产生的变更。

日志的分区提供多种用途。首先，分区允许日志扩展到超出单个服务器所能容纳的大小。每个单独的分区必须适合承载它的服务器，但是一个主题可能有很多分区，因此它可以处理任意数量的数据。其次，分区可以作为并行的处理单元，more on that in a bit（不知道怎么翻）。

## 分布 distribution <a id="distribution></a>


[multi-languages]: https://cwiki.apache.org/confluence/display/KAFKA/Clients
[producer]: ../
[consumer]: ../
[streams]: ../
[connector]: ../
